<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
    <script src = "https://cdn.rawgit.com/greggman/twgl.js/master/dist/4.x/twgl-full.min.js" type="text/javascript"></script>
    <script src = "https://webglfundamentals.org/webgl/resources/m3.js"></script>

    <style>
      body {
          background: #376440;
      }
      [loading] .center {
        display: none;
      }
      .center {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);

        --px: 0;
        --py: 0;
      }
      .relative {
        position: relative;
      }
      
      @media (max-aspect-ratio: 4000/2250) {
        canvas {
          height: 100vh;
        }
      }
      @media (min-aspect-ratio: 4000/2250) {
        canvas {
          width: 100vw;
        }
      }
      

      #icons {
        display: contents;
      }

      .icon, .clickbox {
        --c1x: 0;
        --c1y: 0;
        --c2x: 0;
        --c2y: 0;
        --h: 0;
        
        position: absolute;
        height: calc(100% * var(--h));
        transform: translate(-50%, -50%);
      }
  
      .clickbox {
        top: calc(var(--c1y) * 100%);
        left: calc(var(--c1x) * 100%);
        cursor: pointer;
        opacity: 0;
      }
  
      .icon {
        top: calc(100% * var(--c2y) * var(--py) + 100% * var(--c1y) * (1 - var(--py)));
        left: calc(100% * var(--c2x) * var(--px) + 100% * var(--c1x) * (1 - var(--px)));
      }

      .icon[name = 'tv'][mouseover],
      .icon[name = 'well'][mouseover] {
        visibility: visible;
        opacity: 1;
        transform: translate(-50%, -50%) scale(1.1) rotate(8deg);
      }

      .icon[name = 'tv'],
      .icon[name = 'cf'],
      .icon[name = 'ct'],
      .icon[name = 'well'] {
        opacity: 0;
        visibility: hidden;
        transition: 0.1s ease transform;
      }

      .icon[name = 'cf'][mouseover],
      .icon[name = 'ct'][mouseover]{
        visibility: visible;
      }

      .icon[name = 'cf'],
      .icon[name = 'ct']{
        animation-name: onoff;
        animation-duration: 2s;
        animation-iteration-count: infinite;
      }
      .icon[name = 'cf'] {
        animation-delay: 1s;
      }
      @keyframes onoff {
        0% {opacity: 0;}
        1% {opacity: 1;}
        50% {opacity: 1;}
        51% {opacity: 0;}
        100% {opacity: 0;}
      }



 
   
      
    
    </style>
  </head>
  <body loading>

    <div class = "center">
      <div class = "relative">
        <canvas id="canvas"></canvas>
        <div id = "icons"></div>
        <!-- <div class = "dot"></div> -->
      </div>
    </div>
  </body>
  

  <script type = "module">
    import {load} from "./icons.js"
    import {relative, round, initialise} from "./depth-fader.js"
    await initialise();
    await load();
    
    document.body.removeAttribute("loading")
    let canvas = document.querySelector("canvas");

    window.addEventListener("mousemove", (e) => {
      let [rx, ry] = relative(e, canvas, 1);
      canvas.prlx = [rx, ry];
    });

    // //   let lg = ''
    // //   for (let key in styles) {
    // //     let s = '';
    // //     for (let p in styles[key]) s += `${p}: ${styles[key][p]};\n`
    // //     lg += `.${key} {\n${s}}\n`
    // //   }
    // //   console.log(lg);
    // // }
    // // let mode = 1;
    // // let styles = {};
    // // window.addEventListener("keydown", (e) => {
    // //   console.log(e);
    // //   if (e.key == "s") {
    // //     canvas.prlx = [0, 0];
    // //     mode = 1;
    // //   } else if (e.key == "e") {
    // //     canvas.prlx = [1, 1];
    // //     mode = 2;
    // //   } else if (e.key == "c") {
    // //     document.querySelectorAll(".drag").forEach(a => {
    // //       if (a.prlx) {
    // //         let name = a.getAttribute("name");
    // //         if (!(name in styles)) styles[name] = {};
    // //         let [x, y] = a.prlx;
    // //         styles[name][`--c${mode}x`] = `${round(x*100, 1)}%`;
    // //         styles[name][`--c${mode}y`] = `${round(y*100, 1)}%`;
    // //       }
    // //       logStyle();
    // //     })
        
    // //   }
    // // })


    // const hoverRegions = [
    //   {
    //     name: "cf",
    //     min: [0.506, 0.318],
    //     max: [0.692, 0.737]
    //   },
    //   {
    //     name: "well",
    //     min: [0.385, 0.723],
    //     max: [0.659, 0.927]
    //   },
    //   {
    //     name: "tv",
    //     min: [0.731, 0.653],
    //     max: [0.835, 0.811]
    //   },
    // ]

    // // let interp = []
    // // function logPoints(){
    // //   let X = "";
    // //   let Y = "";
    // //   for (let {x, y} of interp) {
    // //     if (X.length > 0) X += ";\n"
    // //     if (Y.length > 0) Y += ";\n"
    // //     X += `${round(x[0], 7)}, ${round(x[1], 7)}`
    // //     Y += `${round(y[0], 4)}, ${round(y[1], 4)}`
    // //   }
    // //   console.log(`X = [${X}]\nY = [${Y}]`);
    // // }
    
    // let xrel = 0, yrel = 0;
    // window.addEventListener("click", (e) => {
    //     let [rx, ry] = relative(e, canvas, 1);
    //     console.log(round(rx, 3), round(ry, 3));
    // })

    // window.addEventListener("mousemove", (e) => {
    //   let [rx, ry] = relative(e, canvas, 1);
    //   canvas.prlx = [rx, ry];
    //   document.querySelectorAll("[mouseover]").forEach(a => {
    //     if (performance.now() - a.tmo > 100) {
    //       a.removeAttribute("mouseover")
    //     }
    //   })
    //   for (let region of hoverRegions) {
    //     if (rx > region.min[0] && rx < region.max[0] && ry > region.min[1] && ry < region.max[1] ) {
    //       document.querySelectorAll(`[hover="${region.name}"]`).forEach(a => {
    //         a.toggleAttribute("mouseover", true)
    //         a.tmo = performance.now()
    //       })
    //     }
    //   }
    // })

    
    // function addDrag(el) {
    //   console.log(el);
    //   let drag = false;
    //   let x = 0;
    //   let y = 0;
    //   el.addEventListener("mousedown", () => {drag = true; });
    //   window.addEventListener("mouseup", () => {drag = false});
    //   window.addEventListener("mousemove", (e) => {
    //     if (drag) {
    //       let dx = e.movementX / canvas.clientWidth;
    //       let dy = e.movementY / canvas.clientHeight;
    //       x += dx;
    //       y += dy;
    //       el.style.setProperty("--tx", x);
    //       el.style.setProperty("--ty", y);
    //       el.prlx = [x, y];
          
    //     }
    //   })
    // }
    // document.querySelectorAll(".drag").forEach(a => addDrag(a))
   
  </script>
 
</html>
